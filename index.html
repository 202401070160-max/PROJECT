<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PID Gain Calculator for DC Motor</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-2xl w-full bg-white p-8 rounded-xl shadow-lg">
        <!-- Header -->
        <div class="text-center">
            <h1 class="text-3xl font-bold text-gray-800">PID Gain Calculator</h1>
            <p class="text-gray-600 mt-2">For a DC Motor based on IMC Tuning Rules</p>
        </div>

        <!-- Form Grid -->
        <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
            
            <!-- Motor Parameters -->
            <h3 class="md:col-span-2 text-lg font-semibold text-gray-700 border-b pb-2">1. Motor Physical Parameters</h3>
            
            <div>
                <label for="R" class="block text-sm font-medium text-gray-700">Armature Resistance (R<sub>a</sub>) (Ω)</label>
                <input type="number" id="R" value="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
            </div>
            <div>
                <label for="L" class="block text-sm font-medium text-gray-700">Armature Inductance (L<sub>a</sub>) (H)</label>
                <input type="number" id="L" value="0.5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
            </div>
            <div>
                <label for="J" class="block text-sm font-medium text-gray-700">Rotor Inertia (J) (kg·m²)</label>
                <input type="number" id="J" value="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
            </div>
            <div>
                <label for="B" class="block text-sm font-medium text-gray-700">Viscous Friction (B) (N·m·s/rad)</label>
                <input type="number" id="B" value="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
            </div>
            <div>
                <label for="Kt" class="block text-sm font-medium text-gray-700">Torque Constant (K<sub>t</sub>) (N·m/A)</label>
                <input type="number" id="Kt" value="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
            </div>
            <div>
                <label for="Kb" class="block text-sm font-medium text-gray-700">Back EMF Constant (K<sub>b</sub>) (V·s/rad)</label>
                <input type="number" id="Kb" value="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
            </div>

            <!-- Tuning Parameter -->
            <h3 class="md:col-span-2 text-lg font-semibold text-gray-700 border-b pb-2 mt-4">2. Tuning Parameter</h3>
            <div>
                <label for="tau_c" class="block text-sm font-medium text-gray-700">Desired Time Constant (τ<sub>c</sub>) (s)</label>
                <input type="number" id="tau_c" value="0.5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                <p class="text-xs text-gray-500 mt-1">A smaller value (e.g., 0.1) is faster/aggressive. A larger value (e.g., 2.0) is slower/safer.</p>
            </div>
        </div>

        <!-- Calculate Button -->
        <div class="mt-8">
            <button id="calculateBtn" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md font-semibold shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                Calculate PID Gains
            </button>
        </div>

        <!-- Results -->
        <div id="results" class="mt-8 hidden">
            <h3 class="text-lg font-semibold text-gray-700">Calculated Gains</h3>
            <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-green-100 border border-green-300 rounded-md p-4">
                    <label for="Kp" class="block text-sm font-medium text-green-800">K<sub>p</sub> (Proportional)</label>
                    <input type="text" id="Kp" readonly class="mt-1 block w-full rounded-md bg-white border-green-300 shadow-sm">
                </div>
                <div class="bg-green-100 border border-green-300 rounded-md p-4">
                    <label for="Ki" class="block text-sm font-medium text-green-800">K<sub>i</sub> (Integral)</label>
                    <input type="text" id="Ki" readonly class="mt-1 block w-full rounded-md bg-white border-green-300 shadow-sm">
                </div>
                <div class="bg-green-100 border border-green-300 rounded-md p-4">
                    <label for="Kd" class="block text-sm font-medium text-green-800">K<sub>d</sub> (Derivative)</label>
                    <input type="text" id="Kd" readonly class="mt-1 block w-full rounded-md bg-white border-green-300 shadow-sm">
                </div>
            </div>

            <h3 class="text-lg font-semibold text-gray-700 mt-6">Intermediate Model Parameters</h3>
            <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-100 border border-gray-300 rounded-md p-4">
                    <label for="K" class="block text-sm font-medium text-gray-800">Process Gain (K)</label>
                    <input type="text" id="K" readonly class="mt-1 block w-full rounded-md bg-white border-gray-300 shadow-sm">
                </div>
                <div class="bg-gray-100 border border-gray-300 rounded-md p-4">
                    <label for="tau_p" class="block text-sm font-medium text-gray-800">Natural Period (τ<sub>p</sub>)</label>
                    <input type="text" id="tau_p" readonly class="mt-1 block w-full rounded-md bg-white border-gray-300 shadow-sm">
                </div>
                <div class="bg-gray-100 border border-gray-300 rounded-md p-4">
                    <label for="zeta" class="block text-sm font-medium text-gray-800">Damping Ratio (ζ)</label>
                    <input type="text" id="zeta" readonly class="mt-1 block w-full rounded-md bg-white border-gray-300 shadow-sm">
                </div>
            </div>
        </div>
        
        <!-- Error Message -->
        <div id="error" class="mt-6 hidden bg-red-100 border border-red-300 text-red-800 p-4 rounded-md">
            <p>Error: Could not perform calculation. Check for division by zero or invalid parameters.</p>
        </div>

    </div>

    <script>
        document.getElementById('calculateBtn').addEventListener('click', function() {
            // 1. Get all input values
            const R = parseFloat(document.getElementById('R').value);
            const L = parseFloat(document.getElementById('L').value);
            const J = parseFloat(document.getElementById('J').value);
            const B = parseFloat(document.getElementById('B').value);
            const Kt = parseFloat(document.getElementById('Kt').value);
            const Kb = parseFloat(document.getElementById('Kb').value);
            const tau_c = parseFloat(document.getElementById('tau_c').value);

            // Hide previous results/errors
            document.getElementById('results').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');

            // 2. Calculate the 2nd-Order Model Parameters
            // These are derived from matching the G(s) denominator to the
            // standard form: K / (tau_p^2 * s^2 + 2*zeta*tau_p*s + 1)

            const den_const = (R * B) + (Kb * Kt);
            if (den_const === 0) {
                document.getElementById('error').classList.remove('hidden');
                return;
            }

            // K (Process Gain)
            const K = Kt / den_const;
            
            // tau_p (Natural Period)
            const tau_p_sq = (L * J) / den_const;
            const tau_p = Math.sqrt(tau_p_sq);

            // zeta (Damping Ratio)
            const zeta = (L * B + R * J) / (2 * Math.sqrt(L * J * den_const));

            // 3. Calculate PID Gains using IMC (Internal Model Control) rules
            // These are standard formulas for a 2nd-order system
            
            const Kp = (2 * zeta * tau_p) / (K * tau_c);
            const Ki = 1 / (K * tau_c);
            const Kd = (tau_p_sq) / (K * tau_c);

            // 4. Check for valid numbers
            if (isNaN(Kp) || isNaN(Ki) || isNaN(Kd) || !isFinite(Kp) || !isFinite(Ki) || !isFinite(Kd)) {
                document.getElementById('error').classList.remove('hidden');
                return;
            }

            // 5. Display the results
            document.getElementById('Kp').value = Kp.toFixed(4);
            document.getElementById('Ki').value = Ki.toFixed(4);
            document.getElementById('Kd').value = Kd.toFixed(4);

            document.getElementById('K').value = K.toFixed(4);
            document.getElementById('tau_p').value = tau_p.toFixed(4);
            document.getElementById('zeta').value = zeta.toFixed(4);

            document.getElementById('results').classList.remove('hidden');
        });
    </script>

</body>
</html>